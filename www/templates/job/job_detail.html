<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>荐乎</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    <link rel="stylesheet" href="http://res.jian-hu.cn/static/jquery-weui/dist/lib/weui.css">
    <link rel="stylesheet" href="http://res.jian-hu.cn/static/jquery-weui/dist/css/jquery-weui.css">
    <link rel="stylesheet" href="http://res.jian-hu.cn/static/dist/css/app-job.css">
</head>

<body>
<div class="weui_tab">
    <div class="weui_navbar jian-title">
        <a href="javascript:history.back(-1);"><img src="http://res.jian-hu.cn/static/img/back@2x.png"
                                                    class="jian-title-back"></a>

        <div class="jian-title-text">
            职位详情
        </div>
        <div style="position: absolute;right: 11px;top: 0;height: 45px;line-height: 45px;font-size: 16px;color: #ffffff;">
            <span>收藏职位</span>
        </div>
    </div>
    <!--以 weui_tab_bd 作为外部容器，下拉刷新、滚动加载控件必须在这个容器的之中-->
    <div class="weui_tab_bd" style="margin-top: -42px;padding-top: 87px">
        <!--内容区-->
        <div id="content">
            <div class="jian_list_items">
                <!-- item-start -->
                <div class="jian-item-title">
                    <div>
                        <font class="jian-item-title-font">{{ job_title }}</font>
                    </div>

                    <div class="weui-row weui-no-gutter jian-item-content">
                        <div class="weui-col-32">
                            <img class="jian-item-content-img"
                                 src="http://res.jian-hu.cn/static/img/icn_place@2x.png"><font
                                class="jian-item-content-fontyahei">{{ city }}</font>
                        </div>
                        <div class="weui-col-24" style="padding-left: 4px;">
                            <img src="http://res.jian-hu.cn/static/img/icn_time@2x.png"
                                 class="jian-item-content-img"><font
                                class="jian-item-content-fontyahei">{{ work_experience }}</font>
                        </div>
                        <div class="weui-col-22" style="padding-left: 13px;">
                            <img src="http://res.jian-hu.cn/static/img/icn_xueli@2x.png"
                                 class="jian-item-content-img"><font
                                class="jian-item-content-fontyahei">{{ education }}</font>
                        </div>
                        <div class="weui-col-22">
                            <div class="jian-item-content-fontxinzi" style="float: right">￥{{ salary }}</div>
                        </div>
                    </div>

                    <div class="weui-row jian-item-skill">
                        <div class="weui-col-33">
                            <div class="jian-item-content-hidden" id="skill1">
                            </div>

                        </div>

                        <div class="weui-col-33">
                            <div class="jian-item-content-hidden" id="skill2">
                            </div>
                        </div>

                        <div class="weui-col-33">
                            <div class="jian-item-content-hidden" id="skill3">
                            </div>
                        </div>
                    </div>

                    <div class="weui-row" style="margin-top: 6px;">
                        <div class="weui-col-33">
                            <div class="jian-item-content-hidden" id="skill4">
                            </div>

                        </div>

                        <div class="weui-col-33">
                            <div class="jian-item-content-hidden" id="skill5">
                            </div>
                        </div>

                        <div class="weui-col-33">
                            <div class="jian-item-content-hidden" id="skill6">
                            </div>
                        </div>
                    </div>

                </div>
                <!-- item-end -->

                <div class="jian-item-space">
                    <span style="margin-left: 15px;">职位发布者</span>
                </div>

                <div class="weui-row weui-no-gutter jian-item-me" style="margin-top: ">
                    <div class="weui-col-33">
                        <img src="{{ portrait }}" class="jian-item-me-img"><font
                            class="jian-item-me-fontname">{{ username }}</font>
                    </div>

                    <div class="weui-col-33">
                        <div class="jian-item-me-company">
                            <font>{{ company_name }}</font>
                        </div>
                    </div>

                    <div class="weui-col-33">
                        <a href="#">
                            <div class="jian-item-me-zhiwei">
                                <font>共发布20个职位></font>
                            </div>
                        </a>
                    </div>
                </div>

                <div class="jian-item-space">
                    <span style="margin-left: 15px;">办公环境</span>
                </div>

                <div id="img-view" style="margin: 15px;">
                    <div style="width: 100%">
                        <img class="pre_img" id="img1" src="" width="100%">
                    </div>

                    <div style="width: 100%;margin-top: 10px;">
                        <img class="pre_img" id="img2" src="" width="100%">
                    </div>
                </div>
            </div>
        </div>
        <!-- content end -->
        <!--滚动加载控件-->
        <div class="weui-infinite-scroll" id="load-more">
            <div class="infinite-preloader"></div>
            正在加载...
        </div>
    </div>

    <div class="weui_tabbar">
        <a href="/chat/chat" class="weui_tabbar_item" style="padding-top: 0">
            <div class="jian-tabbar-xingqu">
                <span style="margin-top: 14px;">我感兴趣</span>
            </div>
        </a>
        <a href="/job/recommand_job" class="weui_tabbar_item" style="padding-top: 0">
            <div class="jian-tabbar-friend">
                <span style="margin-top: 14px;">推荐好友</span>
            </div>
        </a>

    </div>

</div>
<script src="http://res.jian-hu.cn/static/jquery-weui/dist/lib/jquery-2.1.4.js"></script>
{% include "public/modal.html" %}
<script src="http://res.jian-hu.cn/static/dist/js/app-public.js"></script>
<script src="http://res.jian-hu.cn/static/jquery-weui/dist/js/jquery-weui.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript">

    var skills = '{{ skill|safe }}';

    skills = skills.split(',');
    for (var i = 0; i < skills.length; i++) {
        if (skills[i] != "") {
            $("#skill" + (i + 1)).text(skills[i]);
            $("#skill" + (i + 1)).css('border', '1px solid #d5d5d5');
        }
    }


    var piclist = '{{ piclist|safe }}';
    pics = piclist.split(',');

    if (piclist == "") {
        $('.pre_img').remove();
        $('#load-more').html("∩_∩ 暂无更多图片");
    } else if (piclist != "" && pics.length == 1) {
        $("#img1").attr('src', "http://ugcres.oss-cn-shanghai.aliyuncs.com/" + pics[0]);
        $("#img2").remove();
        $('#load-more').html("∩_∩ 暂无更多图片");
    } else if (pics.length == 2) {
        $("#img1").attr('src', "http://ugcres.oss-cn-shanghai.aliyuncs.com/" + pics[0]);
        $("#img2").attr('src', "http://ugcres.oss-cn-shanghai.aliyuncs.com/" + pics[1]);
        $('#load-more').html("∩_∩ 暂无更多图片");
    } else {
        // $('.weui-infinite-scroll').show();
        $("#img1").attr('src', "http://ugcres.oss-cn-shanghai.aliyuncs.com/" + pics[0]);
        $("#img2").attr('src', "http://ugcres.oss-cn-shanghai.aliyuncs.com/" + pics[1]);
        var img_index = 2;
        var loading = false;  //状态标记
        $('.weui_tab_bd').infinite();
        $('.weui_tab_bd').infinite().on("infinite", function () {
            if (img_index >= pics.length) {
                $('#load-more').html("∩_∩ 暂无更多图片")
                $('.weui_tab_bd').destroyInfinite(); //销毁该组件
                return
            } else {
                if (loading) return;
                loading = true;
                var jian_item1 = '<div style="width: 100%;margin-top: 10px;"><img class="pre_img" src="http://ugcres.oss-cn-shanghai.aliyuncs.com/' + pics[img_index++] + '" width="100%"></div>';
                $("#img-view").append(jian_item1);
                loading = false;
            }
        })
    }

    var post_success = '{{ post_success|safe }}';
    if (post_success == 1) {  //非空显示发布成功
        openPostJobSuccessModal('http://res.jian-hu.cn/static/img/feiji@2x.png',"发布成功！",'快快发给自己的老同学，前同事、现同事、好朋友们，求推荐吧！');
    }

    var jsapi = {{ jsapi|safe }};
    var username = '{{ username|safe }}';
    var company_name = '{{ user_company|safe }}';
    var job_title = '{{ job_title|safe }}';
    var uuid = '{{ uuid|safe }}';
    var portrait = '{{ portrait|safe }}';
    var user_title = '{{user_title|safe}}';

    var user_city = '{{user_city|safe}}';
    var user_desc = '{{user_desc|safe}}';

    $('.jian-item-me-img').on('click',function(event){

        openModal(portrait, username, user_title, company_name, user_city, user_desc);
    });

    wx.config({
        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
        appId: jsapi.appId, // 必填，公众号的唯一标识
        timestamp: jsapi.timestamp, // 必填，生成签名的时间戳
        nonceStr: jsapi.nonceStr, // 必填，生成签名的随机串
        signature: jsapi.signature,// 必填，签名，见附录1
        jsApiList: [
            'previewImage',
            'onMenuShareTimeline',
            'onMenuShareAppMessage'
        ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
    });
    wx.ready(function () {
        $("#img-view").on('click', '.pre_img', function (event) {
            var _this = $(event.target);
            var imgArray = [];
            var curImageSrc = _this.attr('src');
            $('.pre_img').each(function (index, el) {
                var itemSrc = $(this).attr('src');
                imgArray.push(itemSrc);
            });
            wx.previewImage({
                current: curImageSrc,
                urls: imgArray
            });
        });

        wx.onMenuShareTimeline({
            title: company_name+user_title+username+'求你推荐'+job_title+'，快来看看吧！', // 
            link: 'http://wx.jian-hu.cn/job/get_job?job_uuid='+uuid, // 分享链接
            imgUrl: portrait, // 分享图标
            success: function () {
                // 用户确认分享后执行的回调函数
                {#                $.toast("分享成功");#}
                {#                location.href = "/";#}
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
                $.toast("分享失败");
            }
        });
        wx.onMenuShareAppMessage({
            title: '荐乎-用语音荐人！', // 分享标题
            desc: company_name+user_title+username+'求你推荐'+job_title+'，快来看看吧！', // 分享描述
            link: 'http://wx.jian-hu.cn/job/get_job?job_uuid='+uuid, // 分享链接
            imgUrl: portrait, // 分享图标
            type: '', // 分享类型,music、video或link，不填默认为link
            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
            success: function () {
                // 用户确认分享后执行的回调函数
                {#                $.toast("分享成功");#}
                {#                location.href = "/";#}
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
                $.toast("分享失败");
            }
        });
    });

</script>
</body>
</html>
